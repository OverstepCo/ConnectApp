<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Connect App</title>
  <link rel="stylesheet" href="css/framework7.css">
  <link rel="stylesheet" href="css/framework7.bundle.min.css">
  <link rel="stylesheet" href="css/app.css">
</head>

<body>
  <div id="app">
    <div class="panel panel-left panel-cover panel-resizable">
      <div class="block panel-header gradient-background">
        <img src="media/logo.png">
        <h2>Connect</h2>
        <p>Connect App Description</p>
      </div>
      <div class="list no-hairlines" style="margin-top: 10px;">
        <ul>
          <a href="/profile-screen/" class="panel-close item-link no-chevron">
            <li class="item-content">
              <div class="item-media"><i class="material-icons gradient-icon">person</i></div>
              <div class="item-inner">My Profile</div>
            </li>
          </a>
          <a href="/school-search-page/" class="panel-close item-link no-chevron">
            <li class="item-content">
              <div class="item-media"><i class="material-icons gradient-icon">school</i></div>
              <div class="item-inner">Change School</div>
            </li>
          </a>
          <a href="/settings-screen/" class="panel-close item-link no-chevron">
            <li class="item-content">
              <div class="item-media"><i class="material-icons gradient-icon">settings</i></div>
              <div class="item-inner">Settings</div>
            </li>
          </a>
          <a href="/about-screen/" class="panel-close item-link no-chevron">
            <li class="item-content">
              <div class="item-media"><i class="material-icons gradient-icon">info</i></div>
              <div class="item-inner">About</div>
            </li>
          </a>
          <a href="#" onclick="signOut()" class="panel-close item-link no-chevron">
            <li class="item-content">
              <div class="item-media"><i class="material-icons gradient-icon">cloud_off</i></div>
              <div class="item-inner">Sign Out</div>
            </li>
          </a>



          <a href="/welcome-page/" class="panel-close item-link no-chevron">
            <li class="item-content">
              <div class="item-media"><i class="material-icons gradient-icon">add</i></div>
              <div class="item-inner">Welcome</div>
            </li>
          </a>

        </ul>
      </div>
    </div>

    <div class="view view-main" data-url="/">
      <div data-page="index" class="page">


        <div class="navbar no-shadow no-harline navbar-home">
          <div id="navbar" class="navbar-inner school-header">
            <div class="left">
              <a class="panel-open link icon-only">
                <i class="material-icons icon">menu</i>
              </a>
            </div>
            <div>
              <h1>School Of Ross</h1>
              <p>32 Members | 12 Chats | 7 Events</p>
            </div>
            <div class="right">
              <a href="/profile-screen/" class="link icon-only">
                <i class="material-icons icon">person</i>
              </a>
            </div>
          </div>
        </div>

        <!-- Floating Action Button -->
        <div class="fab fab-right-bottom">
          <a href="#">
            <i class="icon material-icons">add</i>
            <i class="icon material-icons">close</i>
          </a>
          <!-- FAB speed dial actions with labels -->
          <div class="fab-buttons fab-buttons-top fab-morf" data-morph-to=".card-block">
            <a href="/new-chat-screen/" class="fab-label-button fab-close">
              <i class="icon material-icons" style="font-size: 15pt">message</i>
              <span class="fab-label">New Chat</span>
            </a>
            <a href="/new-event-screen/" class="fab-label-button fab-close">
              <i class="icon material-icons">event_note</i>
              <span class="fab-label">New Event</span>
            </a>
          </div>
        </div>

        <div class="page-content" style="background-color: #edeff2">
          <div class="row title justify-items-left no-margin-bottom">
            <div>Upcoming Events</div>
            <div class="left">
              <i onclick="swipeLeft()" class="material-icons">keyboard_arrow_left</i>
              <i onclick="swipeRight()" class="material-icons">keyboard_arrow_right</i>
            </div>
          </div>
          <div id="event-swiper-wrapper" data-space-between="0" data-slides-per-view="1" class="swiper-container event-swiper">
            <div id="event-swiper" class="swiper-wrapper">




            </div>
          </div>
          <div class="card-block no-margin-top">
            <div class="title">Subscribed Chats</div>
            <div class="hairline"></div>

            <div id="subscribed-chats-skeleton" class="list media-list skeleton-text no-hairlines no-hairlines-between no-margin">
              <ul>
                <li class="item-content skeleton-effect-pulse">
                  <div class="item-inner">
                    <div class="item-title-row">
                      <div class="item-title">This is Title</div>
                    </div>
                    <div class="item-text">
                      Placeholder text line 1 Text line 2
                    </div>
                  </div>
                </li>
                <li class="item-content skeleton-effect-pulse">
                  <div class="item-inner">
                    <div class="item-title-row">
                      <div class="item-title">This is Title</div>
                    </div>
                    <div class="item-text">
                      Placeholder text line 1 Text
                    </div>
                  </div>
                </li>
              </ul>
            </div>

            <div class="list media-list no-margin-bottom no-hairlines no-hairlines-between no-margin-top">
              <ul id="subscribed-chats">

              </ul>
            </div>
          </div>
          <div class="card-block">
            <div class="title">Unsubscribed Chats</div>
            <div class="hairline"></div>

            <div id="school-group-chats-skeleton" class="list media-list skeleton-text no-hairlines no-hairlines-between no-margin">
              <ul>
                <li class="item-content skeleton-effect-pulse">
                  <div class="item-inner">
                    <div class="item-title-row">
                      <div class="item-title">This is Title</div>
                    </div>
                    <div class="item-subtitle">Subtitle</div>
                    <div class="item-text">
                      Placeholder text line 1 Text line 2
                    </div>
                  </div>
                </li>
                <li class="item-content skeleton-effect-pulse">
                  <div class="item-inner">
                    <div class="item-title-row">
                      <div class="item-title">This is Title</div>
                    </div>
                    <div class="item-subtitle">Subtitle</div>
                    <div class="item-text">
                      Placeholder text line 1 Text
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="list media-list chevron-center no-margin-bottom no-margin-top no-hairlines no-hairlines-between">
              <ul class="school-group-chats" id="school-group-chats">

              </ul>
            </div>
            <div class="row justify-content-center"><a class="link"><i class="material-icons">expand_more</i></a></div>
          </div>
          <div class="card-block">
            <div class="title">School Members</div>
            <div class="hairline"></div>

            <form id="school-searchbar" class="searchbar searchbar-inline">
              <div class="searchbar-inner">
                <div class="searchbar-input-wrap">
                  <input type="search" placeholder="Search">
                  <i class="searchbar-icon"></i>
                  <span class="input-clear-button"></span>
                </div>
                <span class="searchbar-disable-button if-not-aurora">Cancel</span>
              </div>
            </form>
            <div id="members-list" class="list members-list searchbar-found no-hairlines no-hairlines-between no-margin-top">
              <ul>
                <a href="#" class="item-link no-chevron">
                  <li class="item-content">
                    <div class="item-media"><i class="material-icons gradient-icon">person</i></div>
                    <div class="item-inner">Krombopulos Mike</div>
                  </li>
                </a>
                <a href="#" class="item-link no-chevron">
                  <li class="item-content">
                    <div class="item-media"><i class="material-icons gradient-icon">person</i></div>
                    <div class="item-inner">Jane Smith</div>
                  </li>
                </a>

              </ul>
            </div>
            <!-- Nothing found message -->
            <div class="block searchbar-not-found">
              <div class="block-inner">Nothing found</div>
            </div>
          </div>


        </div>
      </div>
    </div>
  </div>


  <script type="text/javascript" src="js/cordova.js"></script>
  <script type="text/javascript" src="js/framework7.bundle.js"></script>
  <script type="text/javascript" src="js/main.js"></script>
  <script type="text/javascript" src="js/chats.js"></script>
  <script type="text/javascript" src="js/user.js"></script>
  <script type="text/javascript" src="js/events.js"></script>





  <!-- Firebase stuff-->
  <script src="js/firebase/firebase-app.js"></script>
  <script src="js/firebase/firebase-auth.js"></script>
  <script src="js/firebase/firebase-database.js"></script>
  <script src="js/firebase/firebase-firestore.js"></script>


  <script>
    var firebaseConfig = {

      apiKey: "AIzaSyBUSM_BAQ81dWuIdGJEyIPWcGul6LQ4HEw",
      authDomain: "connect-proj.firebaseapp.com",
      databaseURL: "https://connect-proj.firebaseio.com",
      projectId: "connect-proj",
      storageBucket: "connect-proj.appspot.com",
      messagingSenderId: "846822998925"

    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    //firebase.auth().signInWithEmailAndPassword("ethandisilvestro@gmail.com", "123456").catch(function(error) {});
    var db = firebase.firestore(); //The referance to the firestore database
    var User; //An objects that contins the user data if the currently signed in user
    var uid; //the id of the user this is the same as User.uid // TODO: Remove this later

    /////////authentication section
    firebase.auth().onAuthStateChanged(function(user) { //This function runs every time the users authentication state changes (eg. the user signs in or out)
      if (user) { // User is signed in.
        uid = user.uid;
        console.log(uid);
        //TODO if user has no school redirict to school selection page
        db.collection("users").doc(uid).get().then(function(user) {
          if (user.exists) { //If the user data exists load the user data
            User = { //Load the users data and store it in an object
              uid: uid,
              firstName: user.get("firstName"),
              lastName: user.get("lastName"),
              school: user.get("school"),
              fullName: function() {
                return "" + this.firstName + " " + this.lastName;
              },
              chats: user.get("chatrooms")
            }
            loadMainPage();

          } else { //If the user data does not exist create new user data // TODO: redirect the user to enter this info
            console.log("No user data document!");
            db.collection("users").doc(uid).set({
                firstName: "First Name",
                lastName: "Last Name",
                school: "null"
              })
              .then(function() {
                console.log("user data successfully created!");
              })
              .catch(function(error) {
                console.error("Error updating user data: ", error);
              });
          }
        });

        //close the login screen if it is open
        var currentPage = app.views.main.router.url;
        if (currentPage == "/login-screen/" || currentPage == "/signup-screen/") {
          self.app.views.main.router.navigate('/home/', {
            reloadCurrent: true,
            ignoreCache: true,
          });
        }
        app.preloader.hide();
      } else { //User is signed out.
        self.app.views.main.router.navigate('/login-screen/', {
          reloadCurrent: true
        });
      }
    });
  </script>
</body>

</html>